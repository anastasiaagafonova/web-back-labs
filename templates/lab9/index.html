{% extends "base.html" %}

{% block lab %}–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ 9{% endblock %}

{% block styles %}
    <link rel="stylesheet" href="{{ url_for('static', filename='lab9/lab9.css') }}">
{% endblock %}

{% block script %}
    <script src="{{ url_for('static', filename='lab9/lab9.js') }}"></script>
{% endblock %}

{% block main %}
<div class="lab9-container">
    <div class="header-controls">
        <div class="user-info">
            {% if session.user %}
                <span>–ü—Ä–∏–≤–µ—Ç, {{ session.user }}! üéÖ</span>
                <a href="{{ url_for('lab9.logout') }}" class="logout-btn">–í—ã–π—Ç–∏</a>
                <button id="resetBtn" class="santa-btn">–î–µ–¥ –ú–æ—Ä–æ–∑</button>
            {% else %}
                <a href="{{ url_for('lab9.login') }}" class="login-btn">–í–æ–π—Ç–∏</a>
                <a href="{{ url_for('lab9.register') }}" class="register-btn">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
            {% endif %}
        </div>
    </div>

    <div class="stats-panel">
        <div class="stat-item">
            <h3>–û—Å—Ç–∞–ª–æ—Å—å –ø–æ–¥–∞—Ä–∫–æ–≤:</h3>
            <div class="stat-value" id="availableGifts">{{ available_gifts }}</div>
        </div>
        <div class="instructions">
            <p>‚ú® –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–æ—Ä–æ–±–∫—É, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –ø–æ–¥–∞—Ä–æ–∫</p>
            <p>‚ö†Ô∏è –ú–æ–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å —Ç–æ–ª—å–∫–æ 3 –ø–æ–¥–∞—Ä–∫–∞</p>
            {% if not session.user %}
                <p class="auth-notice">üîí –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –ø–æ–¥–∞—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º</p>
            {% endif %}
        </div>
    </div>

    <div class="gifts-container">
        {% for position in positions %}
            {% set gift = gifts[loop.index0] %}
            <div class="gift-box" 
                 style="left: {{ position.left }}; top: {{ position.top }}; width: {{ position.width }}; height: {{ position.height }};"
                 data-gift-id="{{ gift.id }}"
                 data-requires-auth="{{ gift.requires_auth }}"
                 {% if gift.id in opened_gift_ids %}data-opened="true"{% endif %}>
                
                {% if gift.id in opened_gift_ids %}
                    <div class="gift-opened">
                        {% if gift.gift_image %}
                            <img src="{{ url_for('static', filename='lab9/' + gift.gift_image) }}" 
                                 alt="–ü–æ–¥–∞—Ä–æ–∫ {{ loop.index }}" 
                                 class="gift-img opened-gift">
                        {% else %}
                            <div class="gift-placeholder">üéÅ</div>
                        {% endif %}
                        <span class="gift-label">–û—Ç–∫—Ä—ã—Ç–æ</span>
                    </div>
                {% else %}
                    <div class="gift-closed">
                        {% if gift.box_image %}
                            <img src="{{ url_for('static', filename='lab9/' + gift.box_image) }}" 
                                 alt="–ö–æ—Ä–æ–±–∫–∞ {{ loop.index }}" 
                                 class="gift-img closed-box">
                        {% else %}
                            <div class="box-placeholder">üì¶</div>
                        {% endif %}
                        <span class="gift-label">–ü–æ–¥–∞—Ä–æ–∫ {{ loop.index }}</span>
                        {% if gift.requires_auth %}
                            <div class="lock-icon">üîí</div>
                        {% endif %}
                    </div>
                {% endif %}
            </div>
        {% endfor %}
    </div>

    <div class="gift-info">
        <p>–ù–æ–≤–æ–≥–æ–¥–Ω–∏–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è –∂–¥—É—Ç –≤–∞—Å!</p>
        <p>–ö–∞–∂–¥—ã–π –ø–æ–¥–∞—Ä–æ–∫ —Å–æ–¥–µ—Ä–∂–∏—Ç —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ</p>
    </div>
</div>

<div id="giftModal" class="modal">
    <div class="modal-content">
        <span class="close-btn">&times;</span>
        <div id="modalBody"></div>
    </div>
</div>
 </div>
        <div class="back-link">
            <a href="/">–ù–∞ –≥–ª–∞–≤–Ω—É—é —Å–∞–π—Ç–∞</a>
        </div>
    </div>
{% endblock %}